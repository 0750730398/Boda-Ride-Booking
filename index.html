<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jinja Boda B Booking and Special Car Hire</title>

<style>
body { font-family: "Segoe UI", sans-serif; background: #f9fafb; margin: 0; }
header { background: linear-gradient(135deg, #0f766e, #14b8a6); color: white; text-align: center; padding: 20px; }
nav { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
nav button { padding: 10px 15px; border: none; border-radius: 8px; background: #0f766e; color: white; cursor: pointer; }
.container { max-width: 550px; margin: auto; padding: 20px; }
.card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; }
input, select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #d1d5db; }
button.submit, button.action { width: 100%; padding: 12px; border: none; border-radius: 12px; background: #0f766e; color: white; font-weight: bold; margin-top: 5px; cursor: pointer; }
button.delete { background: #dc2626; }
.booking, .rider { background: #f3f4f6; padding: 12px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #d1d5db; }
.registration-choice button { background: #14b8a6; margin: 10px 0; }
</style>
</head>

<body>

<header>
<h1>Jinja Boda B Booking and Special Car Hire</h1>
<p>Ride Safe • Arrive on Time • Support Local Riders</p>
</header>

<nav>
<button onclick="showSection('book')">Book Ride</button>
<button onclick="showSection('riderLogin')">Riders/Drivers</button>
<button onclick="openAdmin()">Admin</button>
</nav>

<div class="container">

<!-- BOOK -->
<div id="book" class="card section">
<h2>Book a Ride</h2>
<input id="custName" placeholder="Your Name">
<input id="custPhone" placeholder="Phone Number">
<input id="pickup" placeholder="Pickup Location">
<input id="destination" placeholder="Destination">

<select id="rideType">
<option value="Motorcycle">Motorcycle</option>
<option value="Car">Car</option>
</select>

<select id="time">
<option>Now</option>
<option>In 15 minutes</option>
<option>In 30 minutes</option>
</select>

<button class="submit" onclick="bookRide()">Submit Booking</button>
</div>

<!-- RIDER LOGIN -->
<div id="riderLogin" class="card section" style="display:none;">
<h2>Rider / Admin Login</h2>
<p>Riders: enter your bike plate. Admin: enter PIN</p>
<input id="loginInput" placeholder="Bike Plate or Admin PIN">
<button class="submit" onclick="riderOrAdminLogin()">Login</button>
</div>

<!-- RIDER DASHBOARD -->
<div id="rider" class="card section" style="display:none;">
<h2>Rider Dashboard</h2>
<p>Update location only:</p>
<input id="updatePlate" placeholder="Your Plate">
<button class="submit" onclick="updateMyLocation()">Update My Location</button>
<hr>
<h3>Registered Riders</h3>
<div id="riderProfiles"></div>

<hr>
<h3>Assigned Bookings</h3>
<div id="riderBookings"></div>
</div>

<!-- ADMIN DASHBOARD -->
<div id="admin" class="card section" style="display:none;">
<h2>Admin Dashboard</h2>

<h3>Choose Registration Type</h3>
<div class="registration-choice">
<button onclick="showRegistration('motorcycle')">Register Motorcycle Rider</button>
<button onclick="showRegistration('car')">Register Car Driver</button>
</div>

<div id="motorcycleForm" style="display:none;">
<h3>Add Motorcycle Rider</h3>
<input id="riderName" placeholder="Rider Name">
<input id="riderPhone" placeholder="Phone">
<input id="vehicle" placeholder="Bike Plate">
<input id="riderNIN" placeholder="NIN (Optional)">
<button class="submit" onclick="addRider('Motorcycle')">Add Rider</button>
</div>

<div id="carForm" style="display:none;">
<h3>Add Car Driver</h3>
<input id="driverName" placeholder="Driver Name">
<input id="driverPhone" placeholder="Phone">
<input id="carPlate" placeholder="Car Plate">
<select id="carType">
<option>Sedan</option>
<option>SUV</option>
<option>Van</option>
<option>Pickup</option>
</select>
<input id="driverNIN" placeholder="NIN (Optional)">
<button class="submit" onclick="addRider('Car')">Add Driver</button>
</div>

<hr>
<input id="searchPlate" placeholder="Search plate..." oninput="searchRidersByPlate()">
<div id="riderProfilesAdmin"></div>

<hr>
<div id="bookingList"></div>
</div>

</div>

<script>
const ADMIN_PIN = "1234";
let currentRider = null;
let showAllBookings = false;

const getRiders = () => JSON.parse(localStorage.getItem('riders')||'[]');
const getBookings = () => JSON.parse(localStorage.getItem('bookings')||'[]');

function showRegistration(type){
document.getElementById('motorcycleForm').style.display = type==='motorcycle'?'block':'none';
document.getElementById('carForm').style.display = type==='car'?'block':'none';
}

function showSection(id){
document.querySelectorAll('.section').forEach(s=>s.style.display='none');
document.getElementById(id).style.display='block';
if(id==="admin"){loadAdminRiders();loadAdmin();}
}

function openAdmin(){
const pin=prompt("Enter Admin PIN");
if(pin===ADMIN_PIN) showSection('admin'); else alert("Wrong PIN");
}

function riderOrAdminLogin(){
const v=loginInput.value.trim();
if(v===ADMIN_PIN){showSection('admin');return;}
const r=getRiders().find(x=>x.plate?.toLowerCase()===v.toLowerCase());
if(r){currentRider=r;showSection('rider');loadRiderBookings();}else alert("Not registered");
}

function addRider(type){
navigator.geolocation.getCurrentPosition(p=>{
let riders=getRiders();
let plate=type==='Motorcycle'?vehicle.value:carPlate.value;
if(riders.find(r=>r.plate===plate)){alert("Exists");return;}
riders.push({
id:Date.now(),
name:type==='Motorcycle'?riderName.value:driverName.value,
phone:type==='Motorcycle'?riderPhone.value:driverPhone.value,
plate,
type,
vehicleType:type==='Car'?carType.value:"",
lat:p.coords.latitude,lng:p.coords.longitude
});
localStorage.setItem('riders',JSON.stringify(riders));
loadAdminRiders();
});
}

function updateMyLocation(){
navigator.geolocation.getCurrentPosition(p=>{
let r=getRiders(); let me=r.find(x=>x.plate===updatePlate.value);
me.lat=p.coords.latitude;me.lng=p.coords.longitude;
localStorage.setItem('riders',JSON.stringify(r));
});
}

function bookRide(){
let b=getBookings();
b.push({
id:Date.now(),
customer:custName.value,
phone:custPhone.value,
pickup:pickup.value,
destination:destination.value,
type:rideType.value,
time:time.value,
status:"Pending",
rider:null
});
localStorage.setItem('bookings',JSON.stringify(b));
alert("Booking received");
}

function loadAdminRiders(list=null){
const r=list||getRiders();
riderProfilesAdmin.innerHTML=r.map(x=>`
<div class="rider">${x.name} | ${x.plate} | ${x.type}</div>`).join('');
}

function searchRidersByPlate(){
loadAdminRiders(getRiders().filter(r=>r.plate.toLowerCase().includes(searchPlate.value.toLowerCase())));
}

function loadAdmin(){
bookingList.innerHTML=getBookings().map(b=>`
<div class="booking">${b.customer} | ${b.time}</div>`).join('');
}

/* ===== ADVANCE BOOKING FOR CAR ONLY (SAFE ADDITION) ===== */
const baseTimes=["Now","In 15 minutes","In 30 minutes"];
const carTimes=["In 2 hours","In 4 hours","In 8 hours","In 1 day","In 2 days","In 3 days","In 4 days","In 5 days","In 1 week"];

function updateTimeOptions(){
time.innerHTML="";
baseTimes.forEach(t=>time.add(new Option(t,t)));
if(rideType.value==="Car"){
carTimes.forEach(t=>time.add(new Option(t,t)));
}
}
rideType.addEventListener("change",updateTimeOptions);
updateTimeOptions();
/* ===== END ADDITION ===== */

showSection('book');
</script>

</body>
</html>
