<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jinja Boda B</title>

<style>
:root{
--green:#00C853;
--dark:#1b1b1b;
--light:#f5f7f6;
}
body{
font-family:system-ui,-apple-system,Segoe UI,sans-serif;
background:var(--light);
margin:0;
}
header{
background:var(--green);
color:#fff;
padding:20px;
text-align:center;
}
nav{
display:flex;
justify-content:space-around;
background:#fff;
position:sticky;
top:0;
z-index:10;
border-bottom:1px solid #eee;
}
nav button{
background:none;
border:none;
padding:15px;
font-weight:600;
color:var(--dark);
}
.container{
max-width:420px;
margin:auto;
padding:15px;
}
.card{
background:#fff;
border-radius:16px;
padding:16px;
margin-bottom:15px;
box-shadow:0 4px 12px rgba(0,0,0,.05);
}
input,select,textarea{
width:100%;
padding:14px;
border-radius:12px;
border:1px solid #ddd;
margin-bottom:10px;
}
button.primary{
background:var(--green);
color:#fff;
border:none;
padding:14px;
width:100%;
border-radius:14px;
font-size:16px;
font-weight:700;
}
.status{
display:inline-block;
padding:4px 10px;
border-radius:20px;
font-size:12px;
font-weight:600;
}
.Pending{background:#ffe082}
.Assigned{background:#b3e5fc}
.Completed{background:#c8e6c9}
.rating{color:#ffb300;font-size:14px}
.trip{
border-bottom:1px solid #eee;
padding:10px 0;
}
small{color:#666}
</style>
</head>

<body>

<header>
<h2>Jinja Boda B</h2>
<p>Fast • Safe • Reliable</p>
</header>

<nav>
<button onclick="show('book')">Home</button>
<button onclick="show('customerLogin')">My Trips</button>
<button onclick="show('riderLogin')">Rider</button>
<button onclick="adminLogin()">Admin</button>
</nav>

<div class="container">

<!-- BOOK -->
<div id="book" class="card section">
<h3>Request a Ride</h3>
<input id="custName" placeholder="Your name">
<input id="custPhone" placeholder="Phone number">
<input id="pickup" placeholder="Pickup location">
<input id="destination" placeholder="Where to?">
<select id="rideType">
<option>Motorcycle</option>
<option>Car</option>
</select>
<select id="time"></select>
<button class="primary" onclick="bookRide()">Request Ride</button>
</div>

<!-- CUSTOMER LOGIN -->
<div id="customerLogin" class="card section" style="display:none">
<h3>Login</h3>
<input id="custLoginPhone" placeholder="Phone number">
<button class="primary" onclick="sendOTP()">Continue</button>
<div id="otpBox" style="display:none">
<input id="otpInput" placeholder="Enter OTP">
<button class="primary" onclick="verifyOTP()">Verify</button>
</div>
</div>

<!-- CUSTOMER DASH -->
<div id="customerTrack" class="section" style="display:none">
<h4>My Trips</h4>
<div id="customerTrips"></div>
</div>

<!-- RIDER LOGIN -->
<div id="riderLogin" class="card section" style="display:none">
<h3>Rider Login</h3>
<input id="loginInput" placeholder="Bike / Car plate">
<button class="primary" onclick="riderLogin()">Login</button>
</div>

<!-- RIDER -->
<div id="rider" class="section" style="display:none">
<div class="card">
<h3>Rider Status</h3>
<button id="availabilityBtn" class="primary" onclick="toggleAvailability()">Go Online</button>
<div id="riderRatings"></div>
</div>
</div>

<!-- ADMIN -->
<div id="admin" class="section" style="display:none">
<div class="card">
<h3>Admin</h3>
<button class="primary" onclick="autoAssign()">Auto Assign</button>
<div id="adminRatings"></div>
</div>
</div>

</div>

<script>
const ADMIN_PIN="1234";
const RATE={Motorcycle:1500,Car:3000};
let generatedOTP=null,loggedCustomerPhone=null,currentRider=null;

const riders=()=>JSON.parse(localStorage.getItem("riders")||"[]");
const bookings=()=>JSON.parse(localStorage.getItem("bookings")||"[]");
const saveRiders=r=>localStorage.setItem("riders",JSON.stringify(r));
const saveBookings=b=>localStorage.setItem("bookings",JSON.stringify(b));

function show(id){
document.querySelectorAll(".section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

/* OTP */
function sendOTP(){
generatedOTP=Math.floor(1000+Math.random()*9000);
alert("OTP (demo): "+generatedOTP);
otpBox.style.display="block";
}
function verifyOTP(){
if(otpInput.value==generatedOTP){
loggedCustomerPhone=custLoginPhone.value;
show("customerTrack");
loadCustomer();
}
}

/* BOOK */
function bookRide(){
navigator.geolocation.getCurrentPosition(p=>{
const b=bookings();
b.push({
id:Date.now(),
customer:custName.value,
phone:custPhone.value,
pickup:pickup.value,
destination:destination.value,
type:rideType.value,
time:time.value,
lat:p.coords.latitude,
lng:p.coords.longitude,
status:"Pending",
rating:null,
date:new Date().toLocaleString()
});
saveBookings(b);
alert("Ride requested");
});
}

/* CUSTOMER */
function loadCustomer(){
const b=bookings().filter(x=>x.phone===loggedCustomerPhone);
customerTrips.innerHTML=b.map(x=>`
<div class="card trip">
<b>${x.pickup}</b> → ${x.destination}<br>
<small>${x.date}</small><br>
<span class="status ${x.status}">${x.status}</span><br>
${x.rating?`<div class="rating">${"★".repeat(x.rating)}</div>`:""}
</div>
`).join("");
}

/* RIDER */
function riderLogin(){
const r=riders().find(x=>x.plate===loginInput.value);
if(!r)return alert("Not registered");
currentRider=r;
show("rider");
loadRider();
}
function toggleAvailability(){
const r=riders();const me=r.find(x=>x.plate===currentRider.plate);
me.available=!me.available;
saveRiders(r);
availabilityBtn.textContent=me.available?"Online":"Go Online";
}
function loadRider(){
const r=riders().find(x=>x.plate===currentRider.plate);
riderRatings.innerHTML=`⭐ ${r.ratingAvg?.toFixed(1)||"New Rider"} (${r.ratingCount||0})`;
}

/* ADMIN */
function adminLogin(){if(prompt("PIN")===ADMIN_PIN)show("admin")}
function autoAssign(){alert("Auto dispatch simulated")}
const base=["Now","15 min","30 min"];
function loadTime(){time.innerHTML="";base.forEach(t=>time.add(new Option(t,t)));}
loadTime();
</script>

</body>
</html>
